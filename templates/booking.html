{% extends "base.html" %} {% block title %}Book Tickets - {{ show.movie_title }}
- BookYourShow{% endblock %} {% block content %}
<div class="container-fluid px-4 mt-4">
  <!-- Premium Booking Header -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="glass-card animate-fade-in-up">
        <div class="row align-items-center">
          <div class="col-md-8">
            <h2 class="mb-3">
              <i class="fas fa-ticket-alt me-2 text-gradient-red"></i>Book Your
              Tickets
            </h2>
            <h3 class="text-gradient-red mb-3">{{ show.movie_title }}</h3>
            <div class="booking-info">
              <div class="row g-3">
                <div class="col-md-6">
                  <p class="mb-2">
                    <i class="fas fa-building me-2 text-gradient-red"></i>
                    <strong>{{ show.theater_name }}</strong> - {{
                    show.screen_name }}
                  </p>
                  <p class="mb-2">
                    <i class="fas fa-calendar me-2 text-gradient-red"></i>
                    {{ show.show_time.strftime('%B %d, %Y') }}
                  </p>
                </div>
                <div class="col-md-6">
                  <p class="mb-2">
                    <i class="fas fa-clock me-2 text-gradient-red"></i>
                    {{ show.show_time.strftime('%I:%M %p') }}
                  </p>
                  <p class="mb-0">
                    <i class="fas fa-rupee-sign me-2 text-gradient-red"></i>
                    <strong>₹{{ "%.0f"|format(show.price) }}</strong> per seat
                  </p>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-4 text-md-end mt-3 mt-md-0">
            <div class="badge bg-success px-3 py-2" style="font-size: 1rem">
              <i class="fas fa-check-circle me-1"></i>Available
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Premium Seat Selection -->
  <div class="row">
    <div class="col-lg-8 mb-4">
      <div class="glass-card">
        <h4 class="mb-4">
          <i class="fas fa-couch me-2 text-gradient-red"></i>Select Your Seats
        </h4>

        <!-- Screen -->
        <div class="screen-container text-center mb-5">
          <div class="screen"><i class="fas fa-desktop me-2"></i>SCREEN</div>
        </div>

        <!-- Seat Map -->
        <div class="seat-map-container">
          <div class="seat-map" id="seatMap">
            <!-- Seats will be generated by JavaScript -->
          </div>
        </div>

        <!-- Legend -->
        <div
          class="seat-legend mt-4 pt-4"
          style="border-top: 1px solid var(--border-color)"
        >
          <div class="row text-center g-3">
            <div class="col-6 col-md-3">
              <div class="seat available mx-auto mb-2"></div>
              <small class="d-block">Available</small>
            </div>
            <div class="col-6 col-md-3">
              <div class="seat selected mx-auto mb-2"></div>
              <small class="d-block">Selected</small>
            </div>
            <div class="col-6 col-md-3">
              <div class="seat booked mx-auto mb-2"></div>
              <small class="d-block">Booked</small>
            </div>
            <div class="col-6 col-md-3">
              <div class="seat-gap mx-auto mb-2"></div>
              <small class="d-block">Aisle</small>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="col-lg-4">
      <!-- Premium Booking Summary -->
      <div class="glass-card sticky-top" style="top: 100px">
        <h4 class="mb-4">
          <i class="fas fa-receipt me-2 text-gradient-red"></i>Booking Summary
        </h4>

        <form
          method="POST"
          action="{{ url_for('confirm_booking') }}"
          id="bookingForm"
        >
          <input type="hidden" name="show_id" value="{{ show.show_id }}" />

          <div class="selected-seats-container mb-4">
            <h6 class="mb-3">
              <i class="fas fa-couch me-1"></i>Selected Seats:
            </h6>
            <div
              id="selectedSeats"
              class="mb-3 p-3 rounded"
              style="background: var(--bg-tertiary); min-height: 60px"
            >
              <p class="text-muted mb-0 text-center">No seats selected</p>
            </div>
          </div>

          <hr class="my-4" style="border-color: var(--border-color)" />

          <div class="pricing-details mb-4">
            <div class="d-flex justify-content-between mb-3">
              <span class="text-secondary">Seat Price:</span>
              <span class="fw-bold">₹{{ "%.0f"|format(show.price) }}</span>
            </div>
            <div class="d-flex justify-content-between mb-3">
              <span class="text-secondary">Number of Seats:</span>
              <span class="fw-bold" id="seatCount">0</span>
            </div>
            <hr class="my-3" style="border-color: var(--border-color)" />
            <div class="d-flex justify-content-between mb-3">
              <strong class="fs-5">Total Amount:</strong>
              <strong class="fs-4 text-gradient-red" id="totalAmount"
                >₹0</strong
              >
            </div>
          </div>

          <div class="payment-method mb-4">
            <h6 class="mb-3">
              <i class="fas fa-credit-card me-1"></i>Payment Method:
            </h6>
            <div
              class="form-check mb-2 p-3 rounded"
              style="
                background: var(--bg-tertiary);
                border: 2px solid var(--border-color);
              "
            >
              <input
                class="form-check-input"
                type="radio"
                name="payment_mode"
                id="online"
                value="online"
                checked
              />
              <label class="form-check-label w-100" for="online">
                <i class="fas fa-credit-card me-2"></i>Online Payment
              </label>
            </div>
            <div
              class="form-check p-3 rounded"
              style="
                background: var(--bg-tertiary);
                border: 2px solid var(--border-color);
              "
            >
              <input
                class="form-check-input"
                type="radio"
                name="payment_mode"
                id="offline"
                value="offline"
              />
              <label class="form-check-label w-100" for="offline">
                <i class="fas fa-money-bill me-2"></i>Pay at Counter
              </label>
            </div>
          </div>

          <button
            type="submit"
            class="btn btn-primary btn-lg w-100 glow-effect"
            id="confirmBooking"
            disabled
          >
            <i class="fas fa-check me-2"></i>Confirm Booking
          </button>
        </form>
      </div>
    </div>
  </div>

  <!-- Back Button -->
  <div class="row mt-4 mb-5">
    <div class="col-12">
      <a
        href="{{ url_for('movie_detail', movie_id=show.movie_id) }}"
        class="btn btn-outline-primary"
      >
        <i class="fas fa-arrow-left me-1"></i>Back to Movie Details
      </a>
    </div>
  </div>
</div>
{% endblock %} {% block extra_head %}
<style>
  .screen-container {
    margin-bottom: 40px;
  }

  .screen {
    background: linear-gradient(to bottom, #333, #666);
    color: #ffffff;
    padding: 15px 80px;
    border-radius: 50px;
    display: inline-block;
    font-weight: bold;
    margin-bottom: 30px;
    box-shadow: 0 0 30px rgba(0, 0, 0, 0.3);
    position: relative;
  }

  .screen::before {
    content: "";
    position: absolute;
    top: -10px;
    left: 50%;
    transform: translateX(-50%);
    width: 60%;
    height: 20px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50px;
  }

  .seat-map {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
  }

  .seat-row {
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .row-label {
    width: 30px;
    text-align: center;
    font-weight: bold;
    color: #666;
  }

  .seat {
    width: 35px;
    height: 35px;
    border: 2px solid #ddd;
    border-radius: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: bold;
    transition: all 0.2s;
    background: #f8f9fa;
  }

  .seat.available {
    background: #e8f5e8;
    border-color: #28a745;
    color: #28a745;
  }

  .seat.available:hover {
    background: #d4edda;
    transform: scale(1.1);
  }

  .seat.selected {
    background: #007bff;
    border-color: #007bff;
    color: white;
    transform: scale(1.1);
  }

  .seat.booked {
    background: #dc3545;
    border-color: #dc3545;
    color: white;
    cursor: not-allowed;
  }

  .seat-gap {
    width: 20px;
  }

  .seat-legend {
    border-top: 1px solid #ddd;
    padding-top: 20px;
  }

  .seat-legend .seat {
    margin: 0 auto 10px;
    cursor: default;
  }

  .seat-legend .seat:hover {
    transform: none;
  }

  .selected-seats-container {
    min-height: 60px;
  }

  .seat-tag {
    display: inline-block;
    background: var(--cinema-red);
    color: #ffffff;
    padding: 6px 12px;
    border-radius: 8px;
    margin: 4px;
    font-size: 0.85rem;
    font-weight: 600;
    box-shadow: 0 2px 8px rgba(229, 9, 20, 0.3);
  }

  .selected-seats-container .seat-tag {
    animation: scale-in 0.3s ease-out;
  }

  @media (max-width: 768px) {
    .seat {
      width: 28px;
      height: 28px;
      font-size: 10px;
    }

    .seat-row {
      gap: 4px;
    }

    .row-label {
      width: 25px;
      font-size: 12px;
    }
  }
</style>
{% endblock %} {% block extra_scripts %}
<script>
      document.addEventListener('DOMContentLoaded', function () {
          const seatPrice = {{ show.price }};
          const bookedSeats = {{ booked_seats|tojson }};
          const totalSeats = {{ show.total_seats }};
          let selectedSeats = [];

      // Generate seat map
      function generateSeatMap() {
          const seatMap = document.getElementById('seatMap');
          const rows = Math.ceil(totalSeats / 12); // 12 seats per row

          for (let row = 0; row < rows; row++) {
              const rowDiv = document.createElement('div');
              rowDiv.className = 'seat-row';

              // Row label
              const rowLabel = document.createElement('div');
              rowLabel.className = 'row-label';
              rowLabel.textContent = String.fromCharCode(65 + row); // A, B, C...
              rowDiv.appendChild(rowLabel);

              // Seats in this row
              for (let seat = 1; seat <= 12; seat++) {
                  const seatNumber = `${String.fromCharCode(65 + row)}${seat}`;

                  // Add aisle gap after seat 6
                  if (seat === 7) {
                      const gap = document.createElement('div');
                      gap.className = 'seat-gap';
                      rowDiv.appendChild(gap);
                  }

                  // Check if we've exceeded total seats
                  if ((row * 12) + seat > totalSeats) break;

                  const seatDiv = document.createElement('div');
                  seatDiv.className = 'seat';
                  seatDiv.textContent = seat;
                  seatDiv.dataset.seatNumber = seatNumber;

                  // Set seat status
                  if (bookedSeats.includes(seatNumber)) {
                      seatDiv.classList.add('booked');
                  } else {
                      seatDiv.classList.add('available');
                      seatDiv.addEventListener('click', () => toggleSeat(seatNumber, seatDiv));
                  }

                  rowDiv.appendChild(seatDiv);
              }

              seatMap.appendChild(rowDiv);
          }
      }

      // Toggle seat selection
      function toggleSeat(seatNumber, seatElement) {
          if (seatElement.classList.contains('booked')) return;

          if (selectedSeats.includes(seatNumber)) {
              // Deselect seat
              selectedSeats = selectedSeats.filter(s => s !== seatNumber);
              seatElement.classList.remove('selected');
              seatElement.classList.add('available');
          } else {
              // Select seat (max 10 seats)
              if (selectedSeats.length >= 10) {
                  alert('You can select maximum 10 seats at a time.');
                  return;
              }
              selectedSeats.push(seatNumber);
              seatElement.classList.remove('available');
              seatElement.classList.add('selected');
          }

          updateBookingSummary();
      }

      // Update booking summary
      function updateBookingSummary() {
          const selectedSeatsDiv = document.getElementById('selectedSeats');
          const seatCountSpan = document.getElementById('seatCount');
          const totalAmountSpan = document.getElementById('totalAmount');
          const confirmButton = document.getElementById('confirmBooking');
          const bookingForm = document.getElementById('bookingForm');

          // Remove existing hidden inputs
          const existingInputs = bookingForm.querySelectorAll('input[name="seats"]');
          existingInputs.forEach(input => input.remove());

          if (selectedSeats.length === 0) {
              selectedSeatsDiv.innerHTML = '<p class="text-muted">No seats selected</p>';
              seatCountSpan.textContent = '0';
              totalAmountSpan.textContent = '₹0';
              confirmButton.disabled = true;
          } else {
              // Show selected seats
              const seatTags = selectedSeats.map(seat =>
                  `<span class="seat-tag">${seat}</span>`
              ).join('');
              selectedSeatsDiv.innerHTML = seatTags;

              // Add hidden inputs for selected seats
              selectedSeats.forEach(seat => {
                  const input = document.createElement('input');
                  input.type = 'hidden';
                  input.name = 'seats';
                  input.value = seat;
                  bookingForm.appendChild(input);
              });

              // Update totals
              const totalAmount = selectedSeats.length * seatPrice;
              seatCountSpan.textContent = selectedSeats.length;
              totalAmountSpan.textContent = `₹${totalAmount.toFixed(0)}`;
              confirmButton.disabled = false;
          }
      }

      // Initialize seat map
      generateSeatMap();
  });
</script>
{% endblock %}
