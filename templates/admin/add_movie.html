{% extends "base.html" %}

{% block title %}Add Movie - Admin - BookYourShow{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <h2><i class="fas fa-plus-circle me-2"></i>Add New Movie</h2>
                <a href="{{ url_for('admin_movies') }}" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-1"></i>Back to Movies
                </a>
            </div>
        </div>
    </div>

    <!-- Add Movie Form -->
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">
                        <i class="fas fa-film me-2"></i>Movie Details
                    </h5>
                </div>
                <div class="card-body">
                    <form method="POST" class="needs-validation" novalidate>
                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label for="title" class="form-label">
                                    <i class="fas fa-heading me-1"></i>Movie Title *
                                </label>
                                <input type="text" class="form-control" id="title" name="title"
                                    placeholder="Enter movie title" required>
                                <div class="invalid-feedback">
                                    Please provide a movie title.
                                </div>
                            </div>

                            <div class="col-md-4 mb-3">
                                <label for="genre" class="form-label">
                                    <i class="fas fa-tags me-1"></i>Genre *
                                </label>
                                <select class="form-select" id="genre" name="genre" required>
                                    <option value="">Select Genre</option>
                                    <option value="Action">Action</option>
                                    <option value="Comedy">Comedy</option>
                                    <option value="Drama">Drama</option>
                                    <option value="Horror">Horror</option>
                                    <option value="Romance">Romance</option>
                                    <option value="Sci-Fi">Sci-Fi</option>
                                    <option value="Thriller">Thriller</option>
                                    <option value="Crime">Crime</option>
                                    <option value="Adventure">Adventure</option>
                                    <option value="Animation">Animation</option>
                                    <option value="Documentary">Documentary</option>
                                    <option value="Fantasy">Fantasy</option>
                                </select>
                                <div class="invalid-feedback">
                                    Please select a genre.
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="duration" class="form-label">
                                    <i class="fas fa-clock me-1"></i>Duration (minutes) *
                                </label>
                                <input type="number" class="form-control" id="duration" name="duration"
                                    placeholder="120" min="60" max="300" required>
                                <div class="invalid-feedback">
                                    Please provide a valid duration (60-300 minutes).
                                </div>
                            </div>

                            <div class="col-md-4 mb-3">
                                <label for="rating" class="form-label">
                                    <i class="fas fa-star me-1"></i>Rating (1-10) *
                                </label>
                                <input type="number" class="form-control" id="rating" name="rating" placeholder="8.5"
                                    min="1" max="10" step="0.1" required>
                                <div class="invalid-feedback">
                                    Please provide a valid rating (1-10).
                                </div>
                            </div>

                            <div class="col-md-4 mb-3">
                                <label for="release_date" class="form-label">
                                    <i class="fas fa-calendar me-1"></i>Release Date *
                                </label>
                                <input type="date" class="form-control" id="release_date" name="release_date" required>
                                <div class="invalid-feedback">
                                    Please provide a release date.
                                </div>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label for="description" class="form-label">
                                <i class="fas fa-align-left me-1"></i>Description (Optional)
                            </label>
                            <textarea class="form-control" id="description" name="description" rows="4"
                                placeholder="Enter movie description..."></textarea>
                        </div>

                        <div class="mb-4">
                            <label for="poster" class="form-label">
                                <i class="fas fa-image me-1"></i>Movie Poster (Optional)
                            </label>
                            <input type="file" class="form-control" id="poster" name="poster" accept="image/*">
                            <div class="form-text">
                                Upload a movie poster image (JPG, PNG, GIF). Max size: 5MB
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12">
                                <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                                    <a href="{{ url_for('admin_movies') }}" class="btn btn-outline-secondary me-md-2">
                                        <i class="fas fa-times me-1"></i>Cancel
                                    </a>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save me-1"></i>Add Movie
                                    </button>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Preview Card -->
    <div class="row justify-content-center mt-4">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h6 class="mb-0">
                        <i class="fas fa-eye me-2"></i>Preview
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="movie-poster-preview">
                                <img id="posterPreview"
                                    src="https://via.placeholder.com/200x300/007bff/ffffff?text=Movie+Poster"
                                    class="img-fluid rounded" alt="Movie Poster Preview">
                            </div>
                        </div>
                        <div class="col-md-9">
                            <h4 id="titlePreview" class="text-primary">Movie Title</h4>
                            <div class="movie-meta mb-3">
                                <span class="badge bg-secondary me-2" id="genrePreview">Genre</span>
                                <span class="badge bg-info me-2">
                                    <i class="fas fa-clock me-1"></i><span id="durationPreview">0</span> min
                                </span>
                                <span class="badge bg-warning text-dark">
                                    <i class="fas fa-star me-1"></i><span id="ratingPreview">0</span>
                                </span>
                            </div>
                            <p><strong>Release Date:</strong> <span id="releaseDatePreview">Not set</span></p>
                            <p id="descriptionPreview" class="text-muted">No description provided.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        // Form validation
        const form = document.querySelector('.needs-validation');

        // Real-time preview updates
        const titleInput = document.getElementById('title');
        const genreSelect = document.getElementById('genre');
        const durationInput = document.getElementById('duration');
        const ratingInput = document.getElementById('rating');
        const releaseDateInput = document.getElementById('release_date');
        const descriptionInput = document.getElementById('description');
        const posterInput = document.getElementById('poster');

        // Preview elements
        const titlePreview = document.getElementById('titlePreview');
        const genrePreview = document.getElementById('genrePreview');
        const durationPreview = document.getElementById('durationPreview');
        const ratingPreview = document.getElementById('ratingPreview');
        const releaseDatePreview = document.getElementById('releaseDatePreview');
        const descriptionPreview = document.getElementById('descriptionPreview');
        const posterPreview = document.getElementById('posterPreview');

        // Update preview functions
        titleInput.addEventListener('input', function () {
            titlePreview.textContent = this.value || 'Movie Title';
        });

        genreSelect.addEventListener('change', function () {
            genrePreview.textContent = this.value || 'Genre';
        });

        durationInput.addEventListener('input', function () {
            durationPreview.textContent = this.value || '0';
        });

        ratingInput.addEventListener('input', function () {
            ratingPreview.textContent = this.value || '0';
        });

        releaseDateInput.addEventListener('change', function () {
            if (this.value) {
                const date = new Date(this.value);
                releaseDatePreview.textContent = date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            } else {
                releaseDatePreview.textContent = 'Not set';
            }
        });

        descriptionInput.addEventListener('input', function () {
            descriptionPreview.textContent = this.value || 'No description provided.';
        });

        // Poster preview
        posterInput.addEventListener('change', function () {
            const file = this.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    posterPreview.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // Form submission
        form.addEventListener('submit', function (event) {
            if (!form.checkValidity()) {
                event.preventDefault();
                event.stopPropagation();
            }
            form.classList.add('was-validated');
        });

        // Set default release date to today
        const today = new Date().toISOString().split('T')[0];
        releaseDateInput.value = today;
        releaseDateInput.dispatchEvent(new Event('change'));
    });
</script>
{% endblock %}